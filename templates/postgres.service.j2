[Unit]
Description=Postgres
After=docker.service
Requires=docker.service

[Service]
# Disable the start timeout because pulling the Docker image for the first time
# can take a while.
TimeoutStartSec=0

Restart=always
EnvironmentFile=/etc/environment

# Make sure the data directory exists.
ExecStartPre=~/data/postgres

# Stop and remove the old container.
ExecStartPre=-/usr/bin/docker kill %p-%i
ExecStartPre=-/usr/bin/docker rm %p-%i

# Download the image.
ExecStartPre=/usr/bin/docker pull postgres:9.5

# Start a container.
ExecStart=/bin/bash -c '\
    /usr/bin/docker run \
        --name %p-%i \
        -e POSTGRES_USER=pygotham \
        --volume ~/data/postgres:/var/lib/postgresql/data \
        postgres:9.5'

# Stop and remove the cntainer.
ExecStop=/usr/bin/docker kill %p-%i
ExecStop=/usr/bin/docker rm %p-%i

[X-Fleet]
X-Conflicts=%p.*.service
